<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CINEMATCH - Tu Dating Profile Cinematogr√°fico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        .story-card {
            width: 100%;
            max-width: 540px;
            aspect-ratio: 9/16;
            min-height: 100vh;
        }
        @media (min-width: 640px) {
            .story-card {
                width: 540px;
                height: 960px;
            }
        }
        .slide-container {
            position: relative;
            overflow: hidden;
        }
        .slide-content {
            touch-action: pan-y;
            animation: slideIn 0.4s ease-out;
            overflow-y: auto;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .slide-nudge {
            animation: slideNudge 1.5s ease-in-out 3;
        }
        @keyframes slideNudge {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-10px);
            }
            75% {
                transform: translateX(0);
            }
        }
        .progress-bar {
            transition: width 0.1s linear;
        }
        .slide-indicator {
            transition: all 0.3s ease;
        }
        .slide-indicator.active {
            transform: scale(1.2);
        }
        .slide-indicators-floating {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 540px;
            width: 100%;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(15, 20, 25, 0.95) 0%, rgba(15, 20, 25, 0.8) 70%, rgba(15, 20, 25, 0) 100%);
            backdrop-filter: blur(8px);
            pointer-events: none;
        }
        .slide-indicators-floating > * {
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-[#0f1419] min-h-screen">
    <div id="root" class="container mx-auto px-4 py-8 max-w-2xl"></div>

    <script>
        // Detectar si estamos en entorno de desarrollo/preview
        // isDevelopment = true para: localhost, 127.0.0.1, y preview deployments de Vercel (con -git-)
        const isDevelopment = window.location.hostname === 'localhost' ||
                              window.location.hostname === '127.0.0.1' ||
                              window.location.hostname.includes('-git-'); // Vercel preview deployments
        const isProduction = !isDevelopment;

        // State management
        let state = {
            image: null,
            loading: false,
            result: null,
            error: null,
            useMock: false,
            currentSlide: 0,
            autoSlideTimer: null,
            swipeIndicatorTimer: null,
            touchStartX: 0,
            touchEndX: 0,
            autoSlideEnabled: true,
            hasCompletedCycle: false,
            hasScrolledToResults: false,
            wasRestoredFromStorage: false
        };

        function setState(updates) {
            state = { ...state, ...updates };
            render();
            // Save to localStorage when result changes
            if (updates.result !== undefined) {
                saveToLocalStorage();
            }
        }

        // LocalStorage functions
        const STORAGE_KEY = 'cinematch_results';

        function saveToLocalStorage() {
            try {
                const dataToSave = {
                    result: state.result,
                    image: state.image,
                    timestamp: Date.now()
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const data = JSON.parse(saved);
                    // Only load if less than 7 days old
                    const sevenDays = 7 * 24 * 60 * 60 * 1000;
                    if (Date.now() - data.timestamp < sevenDays) {
                        return {
                            result: data.result,
                            image: data.image
                        };
                    } else {
                        // Clear old data
                        localStorage.removeItem(STORAGE_KEY);
                    }
                }
            } catch (error) {
                console.error('Error loading from localStorage:', error);
            }
            return null;
        }

        function clearLocalStorage() {
            try {
                localStorage.removeItem(STORAGE_KEY);
            } catch (error) {
                console.error('Error clearing localStorage:', error);
            }
        }

        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    setState({ 
                        image: e.target.result, 
                        result: null, 
                        error: null 
                    });
                };
                reader.readAsDataURL(file);
            }
        }

        async function analyzeProfile() {
            if (!state.image) return;

            setState({ loading: true, error: null });

            try {
                const base64Data = state.image.split(',')[1];

                // Llamar a nuestra funci√≥n serverless
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        imageData: base64Data,
                        useMock: state.useMock
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                let analysisText = data.content.find(item => item.type === 'text')?.text || '';

                analysisText = analysisText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();

                const analysis = JSON.parse(analysisText);
                setState({ result: analysis, loading: false, wasRestoredFromStorage: false });
            } catch (err) {
                console.error('Error:', err);
                setState({
                    error: 'Error al analizar el perfil. Intenta de nuevo.',
                    loading: false
                });
            }
        }

        async function downloadResult() {
            const resultCard = document.getElementById('result-card');
            if (!resultCard) return;

            try {
                const canvas = await html2canvas(resultCard, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    logging: false
                });

                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'cinematch-profile.png';
                    a.click();
                    URL.revokeObjectURL(url);
                });
            } catch (err) {
                console.error('Error generating image:', err);
            }
        }

        function resetApp() {
            stopAutoSlide();
            stopSwipeIndicatorTimer();
            clearLocalStorage();
            setState({
                result: null,
                image: null,
                currentSlide: 0,
                autoSlideEnabled: true,
                hasCompletedCycle: false,
                hasScrolledToResults: false,
                wasRestoredFromStorage: false
            });
        }

        // Slide navigation functions - tiempos mucho m√°s largos
        const SLIDE_DURATIONS = [15000, 20000, 18000, 25000, 25000]; // Duration for each slide in ms
        const TOTAL_SLIDES = 5;

        function nextSlide() {
            stopSwipeIndicatorTimer();
            if (state.currentSlide < TOTAL_SLIDES - 1) {
                setState({
                    currentSlide: state.currentSlide + 1
                });
                if (state.autoSlideEnabled) {
                    startAutoSlide();
                }
            } else {
                // Reached the end, disable auto-slide
                setState({ hasCompletedCycle: true, autoSlideEnabled: false });
                stopAutoSlide();
            }
        }

        function prevSlide() {
            stopSwipeIndicatorTimer();
            if (state.currentSlide > 0) {
                // Going backwards disables auto-slide
                setState({
                    currentSlide: state.currentSlide - 1,
                    autoSlideEnabled: false
                });
                stopAutoSlide();
            }
        }

        function goToSlide(index) {
            stopSwipeIndicatorTimer();
            if (index >= 0 && index < TOTAL_SLIDES) {
                // User clicked on a dot - disable auto-slide
                setState({
                    currentSlide: index,
                    autoSlideEnabled: false
                });
                stopAutoSlide();
            }
        }

        function startAutoSlide() {
            if (!state.autoSlideEnabled) return;

            stopAutoSlide();
            stopSwipeIndicatorTimer();

            const duration = SLIDE_DURATIONS[state.currentSlide];
            const indicatorDelay = Math.max(3000, duration - 5000); // Mostrar 5s antes del autoswipe, m√≠nimo despu√©s de 3s

            // Solo mostrar nudge si NO es la √∫ltima slide
            if (state.currentSlide < TOTAL_SLIDES - 1) {
                // Mostrar nudge antes del autoswipe
                state.swipeIndicatorTimer = setTimeout(() => {
                    const slideContent = document.querySelector('.slide-content');
                    if (slideContent) {
                        slideContent.classList.add('slide-nudge');
                        // Remover la clase despu√©s de la animaci√≥n (4.5s = 1.5s * 3 repeticiones)
                        setTimeout(() => {
                            slideContent.classList.remove('slide-nudge');
                        }, 4500);
                    }
                }, indicatorDelay);

                // Auto-slide despu√©s del tiempo completo
                state.autoSlideTimer = setTimeout(() => {
                    if (state.currentSlide < TOTAL_SLIDES - 1 && state.autoSlideEnabled) {
                        nextSlide();
                    }
                }, duration);
            }
        }

        function stopAutoSlide() {
            if (state.autoSlideTimer) {
                clearTimeout(state.autoSlideTimer);
                state.autoSlideTimer = null;
            }
        }

        function stopSwipeIndicatorTimer() {
            if (state.swipeIndicatorTimer) {
                clearTimeout(state.swipeIndicatorTimer);
                state.swipeIndicatorTimer = null;
            }
        }

        function handleTouchStart(e) {
            state.touchStartX = e.touches[0].clientX;
            stopAutoSlide();
        }

        function handleTouchMove(e) {
            state.touchEndX = e.touches[0].clientX;
        }

        function handleTouchEnd() {
            const swipeThreshold = 50;
            const diff = state.touchStartX - state.touchEndX;

            if (Math.abs(diff) > swipeThreshold) {
                // User swiped manually - disable auto-slide
                stopSwipeIndicatorTimer();
                setState({ autoSlideEnabled: false });
                if (diff > 0) {
                    // Swipe left - next slide
                    nextSlide();
                } else {
                    // Swipe right - previous slide
                    prevSlide();
                }
            } else {
                // Resume auto-slide if no swipe detected
                if (state.autoSlideEnabled) {
                    startAutoSlide();
                }
            }
        }

        function getSlideContent(slideIndex, result) {
            switch(slideIndex) {
                case 0: // Arquetipo + Bio
                    return `
                        <div class="h-full flex flex-col justify-center">
                            <div class="text-center mb-6">
                                <h2 class="text-3xl font-bold mb-2 text-[#ff006e]">CINEMATCH</h2>
                                <p class="text-sm text-gray-400">Tu Dating Profile Cinematogr√°fico</p>
                            </div>

                            <div class="bg-[#2c3440] rounded-2xl p-6 border-2 border-[#ff006e]">
                                <div class="text-center mb-4">
                                    <div class="text-4xl mb-2">${result.archetype?.emoji || 'üé≠'}</div>
                                    <h3 class="text-2xl font-bold text-[#ffd93d] mb-1">
                                        ${result.archetype?.title || 'TU ARQUETIPO'}
                                    </h3>
                                    <p class="text-xs text-gray-400 italic">
                                        (${result.archetype?.subtitle || result.archetype?.title || 'The Archetype'})
                                    </p>
                                </div>

                                <p class="text-sm leading-relaxed text-gray-200 mb-4">
                                    ${result.archetype?.description || result.bio}
                                </p>

                                ${result.archetype?.rarity ? `
                                    <div class="text-center pt-4 border-t border-[#445566]">
                                        <p class="text-xs text-gray-400">Rareza:</p>
                                        <p class="text-lg font-bold text-[#ff006e]">${result.archetype.rarity}</p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;

                case 1: // First Date Reactions
                    return `
                        <div class="h-full flex flex-col justify-center">
                            <div class="text-center mb-6">
                                <div class="text-5xl mb-2">üí¨</div>
                                <h3 class="text-2xl font-bold text-[#ffd93d]">FIRST DATE REACTIONS</h3>
                                <p class="text-xs text-gray-400 mt-1">Lo que dijeron despu√©s de salir contigo</p>
                            </div>

                            <div class="space-y-4">
                                ${(result.firstDateReactions || []).map(reaction => `
                                    <div class="bg-[#2c3440] rounded-xl p-4 border border-[#445566]">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-sm font-semibold text-[#ffd93d]">${reaction.user}</span>
                                            <span class="text-sm text-[#ff006e]">${reaction.rating}</span>
                                        </div>
                                        <p class="text-sm leading-relaxed text-gray-300">"${reaction.comment}"</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;

                case 2: // Love Languages
                    return `
                        <div class="h-full flex flex-col justify-center">
                            <div class="text-center mb-6">
                                <div class="text-5xl mb-2">‚ù§Ô∏è</div>
                                <h3 class="text-2xl font-bold text-[#ffd93d]">C√ìMO AMAS</h3>
                                <p class="text-xs text-gray-400 mt-1">Seg√∫n tu Letterboxd</p>
                            </div>

                            <div class="space-y-4">
                                <div class="bg-[#2c3440] rounded-xl p-5 border border-[#ff006e]">
                                    <h4 class="text-sm font-bold text-[#ff006e] mb-3 flex items-center gap-2">
                                        <span>üíò</span> EN CITAS:
                                    </h4>
                                    <p class="text-sm leading-relaxed text-gray-200">
                                        ${result.loveLanguages?.dating || 'Tu forma de coquetear involucra referencias cinematogr√°ficas que solo 3 personas van a entender.'}
                                    </p>
                                </div>

                                <div class="bg-[#2c3440] rounded-xl p-5 border border-[#445566]">
                                    <h4 class="text-sm font-bold text-[#ffd93d] mb-3 flex items-center gap-2">
                                        <span>ü§ù</span> EN GENERAL:
                                    </h4>
                                    <p class="text-sm leading-relaxed text-gray-200">
                                        ${result.loveLanguages?.general || 'Expresas afecto a trav√©s de experiencias compartidas, no palabras vac√≠as.'}
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;

                case 3: // Best/Worst Matches
                    return `
                        <div class="h-full flex flex-col justify-center overflow-y-auto">
                            <div class="text-center mb-4">
                                <div class="text-5xl mb-2">üíò</div>
                                <h3 class="text-2xl font-bold text-[#ffd93d]">COMPATIBILITY</h3>
                            </div>

                            <!-- Best Matches -->
                            <div class="mb-4">
                                <h4 class="text-lg font-bold text-[#00d9a3] mb-3 flex items-center gap-2">
                                    <span>‚ú®</span> BEST MATCHES
                                </h4>
                                <div class="space-y-3">
                                    ${(result.bestMatches || []).map(match => `
                                        <div class="bg-[#2c3440] rounded-xl p-4 border border-[#00d9a3]">
                                            <div class="flex items-center justify-between mb-2">
                                                <h5 class="text-sm font-bold text-white">${match.emoji || 'üé≠'} ${match.type}</h5>
                                                <span class="text-sm font-bold text-[#00d9a3]">${match.percentage || '89%'}</span>
                                            </div>
                                            <p class="text-xs text-gray-300 mb-1">‚Üí ${match.dating}</p>
                                            <p class="text-xs text-gray-400">‚Üí ${match.general}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <!-- Worst Matches -->
                            <div>
                                <h4 class="text-lg font-bold text-[#ff4757] mb-3 flex items-center gap-2">
                                    <span>üíî</span> WORST MATCHES
                                </h4>
                                <div class="space-y-3">
                                    ${(result.worstMatches || []).map(match => `
                                        <div class="bg-[#2c3440] rounded-xl p-4 border border-[#ff4757]">
                                            <div class="flex items-center justify-between mb-2">
                                                <h5 class="text-sm font-bold text-white">${match.emoji || 'üé™'} ${match.type}</h5>
                                                <span class="text-sm font-bold text-[#ff4757]">${match.percentage || '9%'}</span>
                                            </div>
                                            <p class="text-xs text-gray-300 mb-1">‚Üí ${match.dating}</p>
                                            <p class="text-xs text-gray-400">‚Üí ${match.general}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;

                case 4: // Veredicto Final
                    return `
                        <div class="h-full flex flex-col justify-center">
                            <div class="text-center mb-6">
                                <div class="text-5xl mb-2">üìã</div>
                                <h3 class="text-2xl font-bold text-[#ffd93d]">VEREDICTO FINAL</h3>
                            </div>

                            <div class="bg-[#2c3440] rounded-2xl p-6 border border-[#445566] overflow-y-auto max-h-[600px]">
                                ${(result.verdict || []).map(paragraph => `
                                    <p class="text-sm leading-relaxed text-gray-200 mb-4 last:mb-0">
                                        ${paragraph}
                                    </p>
                                `).join('')}
                            </div>
                        </div>
                    `;

                default:
                    return '<div>Slide no encontrada</div>';
            }
        }

        function render() {
            const root = document.getElementById('root');
            
            root.innerHTML = `
                <!-- Header -->
                <div class="text-center mb-8">
                    <h1 class="text-5xl font-bold text-[#ff006e] mb-2">
                        CINEMATCH
                    </h1>
                    <p class="text-gray-400 text-lg">Tu Dating Profile Cinematogr√°fico</p>
                </div>

                ${!state.result ? `
                <!-- Upload Section -->
                <div class="bg-[#14181c] rounded-2xl shadow-xl p-8 mb-6 border border-[#2c3440]">
                    <div class="text-center mb-6">
                        <p class="text-gray-300 mb-4">
                            Sube un screenshot de tu perfil de Letterboxd con tus 4 pel√≠culas favoritas y √∫ltimas vistas
                        </p>
                    </div>

                    <label class="flex flex-col items-center justify-center w-full h-64 border-2 border-dashed border-[#445566] rounded-xl cursor-pointer hover:border-[#ff006e] transition-all bg-[#1a1f26] hover:bg-[#2c3440]">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <svg class="w-12 h-12 mb-3 text-[#ff006e]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <p class="mb-2 text-sm text-gray-300">
                                <span class="font-semibold">Click para subir</span> o arrastra aqu√≠
                            </p>
                            <p class="text-xs text-gray-500">PNG, JPG (MAX. 5MB)</p>
                        </div>
                        <input 
                            type="file" 
                            class="hidden" 
                            accept="image/*"
                            id="file-input"
                        />
                    </label>

                    ${state.image ? `
                        <div class="mt-6">
                            <img src="${state.image}" alt="Preview" class="rounded-lg mx-auto max-h-64 object-contain" />

                            ${!isProduction ? `
                                <div class="mt-4 p-3 bg-[#2c3440] border border-[#ffd93d] rounded-lg">
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input
                                            type="checkbox"
                                            id="mock-checkbox"
                                            ${state.useMock ? 'checked' : ''}
                                            onchange="setState({ useMock: this.checked })"
                                            class="w-4 h-4 text-[#ffd93d] rounded focus:ring-[#ffd93d]"
                                        />
                                        <span class="text-sm text-[#ffd93d] font-medium">
                                            üõ†Ô∏è Modo Debug (usar mock data - solo dev/preview)
                                        </span>
                                    </label>
                                </div>
                            ` : ''}

                            <button
                                onclick="analyzeProfile()"
                                ${state.loading ? 'disabled' : ''}
                                class="w-full mt-4 bg-[#ff006e] text-white py-4 rounded-xl font-semibold text-lg hover:bg-[#e6006a] transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                ${state.loading ? 'üé¨ Analizando tu taste...' : 'üíò Generar Mi Perfil'}
                            </button>
                        </div>
                    ` : ''}

                    ${state.error ? `
                        <div class="mt-4 p-4 bg-[#2c3440] border border-[#ff4757] rounded-lg text-[#ff4757] text-center">
                            ${state.error}
                        </div>
                    ` : ''}
                </div>

                <!-- Instructions -->
                <div class="bg-[#14181c] rounded-2xl shadow-lg p-6 border border-[#2c3440]">
                    <h3 class="font-bold text-lg mb-3 text-[#ffd93d]">üì∏ C√≥mo tomar tu screenshot:</h3>
                    <ol class="space-y-2 text-gray-300">
                        <li>1. Ve a tu perfil de Letterboxd</li>
                        <li>2. Aseg√∫rate que se vean tus 4 pel√≠culas favoritas</li>
                        <li>3. Aseg√∫rate que se vean tus √∫ltimas 4 pel√≠culas vistas</li>
                        <li>4. Toma screenshot y s√∫belo aqu√≠</li>
                    </ol>
                </div>
                ` : `
                <!-- Floating Slide Indicators - Always Visible -->
                <div class="slide-indicators-floating px-4 pt-3 pb-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            ${Array.from({length: TOTAL_SLIDES}).map((_, i) => `
                                <button
                                    onclick="goToSlide(${i})"
                                    class="slide-indicator ${i === state.currentSlide ? 'active' : ''} w-3 h-3 rounded-full transition-all cursor-pointer ${i === state.currentSlide ? 'bg-[#ff006e]' : i < state.currentSlide ? 'bg-[#ff006e] opacity-60 hover:opacity-80' : 'bg-[#445566] hover:bg-[#5a6678]'}"
                                    aria-label="Ir a slide ${i + 1}"
                                ></button>
                            `).join('')}
                        </div>
                        <div class="text-sm font-bold">
                            <span class="text-[#ff006e]">${state.currentSlide + 1}</span><span class="text-gray-500">/${TOTAL_SLIDES}</span>
                        </div>
                    </div>
                </div>

                <!-- Result Card with Slides -->
                <div class="space-y-6">
                    <div
                        id="result-card"
                        class="story-card bg-[#14181c] rounded-3xl shadow-2xl overflow-hidden mx-auto border border-[#2c3440] slide-container"
                        ontouchstart="handleTouchStart(event)"
                        ontouchmove="handleTouchMove(event)"
                        ontouchend="handleTouchEnd()"
                    >
                        <div class="h-full flex flex-col text-white relative">
                            <!-- Slide Content -->
                            <div class="flex-1 p-4 pt-16 slide-content overflow-y-auto">
                                ${getSlideContent(state.currentSlide, state.result)}
                            </div>

                            <!-- Footer -->
                            <div class="text-center py-2 flex-shrink-0 bg-[#14181c]">
                                <p class="text-[9px] text-gray-500">cinematch.app (fake lol)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="space-y-4">
                        ${state.wasRestoredFromStorage ? `
                            <div class="bg-[#2c3440] border border-[#ffd93d] rounded-xl p-3 text-center">
                                <p class="text-sm text-[#ffd93d]">
                                    ‚ú® Tus resultados fueron restaurados
                                </p>
                            </div>
                        ` : ''}
                        <div class="flex gap-4">
                            <button
                                onclick="downloadResult()"
                                class="flex-1 bg-[#ff006e] text-white py-4 rounded-xl font-semibold text-lg hover:bg-[#e6006a] transition-all"
                            >
                                üì± Descargar para Stories
                            </button>
                            <button
                                onclick="resetApp()"
                                class="flex-1 bg-[#2c3440] text-gray-300 py-4 rounded-xl font-semibold text-lg hover:bg-[#3a4554] transition-all border border-[#445566]"
                            >
                                üîÑ Hacer Otro
                            </button>
                        </div>
                    </div>
                </div>
                `}
            `;

            // Re-attach event listener for file input
            const fileInput = document.getElementById('file-input');
            if (fileInput) {
                fileInput.addEventListener('change', handleImageUpload);
            }

            // Start auto-slide when result is shown
            if (state.result && !state.autoSlideTimer) {
                startAutoSlide();
            }

            // Auto-scroll to center results when they appear (only once)
            if (state.result && !state.hasScrolledToResults) {
                const resultCard = document.getElementById('result-card');
                if (resultCard) {
                    state.hasScrolledToResults = true;
                    setTimeout(() => {
                        resultCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
            }
        }

        // Load saved data on startup
        const savedData = loadFromLocalStorage();
        if (savedData) {
            state.result = savedData.result;
            state.image = savedData.image;
            state.wasRestoredFromStorage = true;
        }

        // Initial render
        render();
    </script>
</body>
</html>
